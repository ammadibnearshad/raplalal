<div id="{{ section.settings.form_21_unique_id }}" style="display: none;" class="twentieth-first-form">
  <div class="form-block-wrapper form-block-21 flex-block flex-center single-form">
    <div class="left-block">
      <div class="left-block-box">
        <!-- <div class="block-num">21</div> -->
        <div class="content-box">
          <p class="ques-text content-heading">{{ section.settings.form_21_question }}</p>
          <div class="options-box">
            {% if section.settings.form_21_option_1 != blank %}
              <div class="option option1" onclick="handleOptionClickForForm21(event, 'known_allergies_form')">
                <span>A</span> {{ section.settings.form_21_option_1 | replace: "'","" }}
              </div>
            {% endif %}
            {% if section.settings.form_21_option_2 != blank %}
              <div class="option option1" onclick="handleOptionClickForForm21(event, 'known_allergies_form')">
                <span>B</span> {{ section.settings.form_21_option_2 | replace: "'","" }}
              </div>
            {% endif %}
            {% if section.settings.form_21_option_3 != blank %}
              <div class="option option1" onclick="handleOptionClickForForm21(event, 'known_allergies_form')">
                <span>C</span> {{ section.settings.form_21_option_3  }}
              </div>
            {% endif %}
            {% if section.settings.form_21_option_4 != blank %}
              <div class="option option1" onclick="handleOptionClickForForm21(event, 'known_allergies_form')">
                <span>D</span> {{ section.settings.form_21_option_4 | replace: "'","" }}
              </div>
            {% endif %}
          </div>
          <div class="buttons">
            <button
              id="backButton21"
              style="display: block;"
              class="button"
              onclick="showPreviousSnippet21('need_anesthesia')"
            >
              {{ section.settings.back_btn_text }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function handleOptionClickForForm21(event, nextSnippetId) {
    const clickedOptionText = event.currentTarget.textContent.trim().replace(/[A-Z]\s/, '');
    const snippetId = event.currentTarget.closest('.twentieth-first-form').id;

    const currentSnippet = document.getElementById(snippetId);
    currentSnippet.style.display = 'none';
      // if(clickedOptionText.toLowerCase() == 'non' or ) {
        
      // }
    const nextSnippet = document.getElementById(nextSnippetId);
    if (nextSnippet) {
      nextSnippet.style.display = 'block';
    }
    const lineItemId = `line_item-${snippetId}`;
    const inputField = document.getElementById(lineItemId);
    if (inputField) {
      inputField.value = clickedOptionText;
      
      const value = inputField.value.trim().toLowerCase();
      const isAffirmative = !(value === 'non' || value === 'no' );

      const toggleInputs = document.querySelectorAll("[data-toggle-address]");

      const submitButton = document.getElementById('submitButton');
      const mandatoryFields = document.querySelectorAll('.submission-data input[required]');
  
     function checkFieldsaz() {
        let allFieldsValid = true;
      
        mandatoryFields.forEach(function(field) {
          const isVisible = window.getComputedStyle(field).display !== 'none';
          const isEmpty = field.value.trim() === '';
      
          if (isVisible && isEmpty) {
            allFieldsValid = false;
          }
        });
      
        if (allFieldsValid) {
          submitButton.removeAttribute('disabled');
        } else {
          submitButton.setAttribute('disabled', 'disabled');
        }
      }

      
      toggleInputs.forEach(input => {
        if (!isAffirmative) {
          input.style.display = "none";
          input.removeAttribute("required");
          submitButton.removeAttribute('disabled');
        } else {
          input.style.display= "";
          if (input.dataset.wasRequired === 'true') {
            input.setAttribute("required", "required");
          }
        }
      });
      checkFieldsaz();
    }
  }

  function showPreviousSnippet21(previousSnippetId) {
    const previousSnippet = document.getElementById(previousSnippetId);
    if (previousSnippet) {
      previousSnippet.style.display = 'block';
    }

    const currentSnippet = document.getElementById('{{ section.settings.form_21_unique_id }}');
    currentSnippet.style.display = 'none';
  }
</script>
